<!DOCTYPE html>
<HTML>
	<head>  
		<title>devicecheck</title>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<meta name="author" content="Gerald Franz"/>
		<meta name="description" content="a device/browser test page"/>
		<meta name="keywords" content="HTML5, mobile web, JavaScript, canvas"/>

		<!-- iOS settings -->
		<meta name="mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="viewport" content="user-scalable=no, width=device-width" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black" />

		<style type="text/css">
html, body {
	overflow:hidden;
	height:100%;
	margin: 0 auto;
	font-family:Helvetica,sans-serif;
	font-size: 16px;
	color:white;
	background-color:rgb(63,63,63);
}

.button {
	position: absolute;
	left:0;
	bottom:0;
	z-index:100;
	padding: 16px;
	background:rgba(255,255,255,0.15);
}
.button:hover {
	background:rgba(255,255,255,0.3);
}
		</style>

		<script type="text/javascript"> document.ontouchmove = function(event){ if(window.navigator.standalone) event.preventDefault(); } // prevent elastic scrolling </script>
		
		<script type="text/javascript" src="infra.js"></script>
		<script type="text/javascript">cfg = { name:'devicecheck', version:'0.5a', netTimeout:4000 };</script>
		<script type="text/javascript">
var dc;

function drawCircle(dc, x,y, r,w, stroke, fill) {
	if(w && stroke) {
		dc.strokeStyle = stroke;
		dc.lineWidth = w;
		dc.beginPath();
		dc.arc(x,y, r, 0, 2*Math.PI, true);
		dc.closePath();
		dc.stroke();
	}
	if(fill) {
		dc.fillStyle = fill;
		dc.beginPath();
		dc.arc(x,y, r, 0, 2*Math.PI, true);
		dc.closePath();
		dc.fill();
	}
}

function handlePointerEvent(event) {
	if(event.type =='start')
		drawCircle(dc, event.x, event.y, 10, 2, 'rgb(0,255,63)');
	else if(event.type== 'end')
		drawCircle(dc, event.x, event.y, 10, 2, 'rgb(255,63,0)');
	else if(event.type=='move')
		drawCircle(dc, event.x, event.y, 2, 0, null, 'rgb(0,63,255)');
		
	if(event.type != 'move' && event.type != 'hover') {
		var evt = { type:event.type, id:event.id, x:Math.round(event.x), y:Math.round(event.y), ptr:event.pointerType }
		document.getElementById("output").innerHTML += '<br/>\n'+JSON.stringify(evt).replace(/,/g,', ');
	}
	return true;
}

function init() {
	var canvas = document.getElementById("canvas");
	canvas.pixelRatio = window.devicePixelRatio ? window.devicePixelRatio : 1.0;
	dc = canvas.getContext("2d");

	var receptor = canvas;
	eludi.addPointerEventListener(receptor, handlePointerEvent);

	// key events:
	receptor.tabIndex=1; // also turns on keyboard events
	receptor.focus();
	receptor.addEventListener('keydown', function(event) {
		document.getElementById("output").innerHTML += ' '+ event.keyCode;
	});

	window.onresize = function() {
		var metrics = { innerWidth:window.innerWidth, innerHeight:window.innerHeight };
		var canvas = document.getElementById("canvas");
		canvas.style.width = metrics.innerWidth+'px';
		canvas.style.height =  (metrics.innerHeight-160) + 'px';
		canvas.width = metrics.innerWidth * canvas.pixelRatio;
		canvas.height = (metrics.innerHeight-160) * canvas.pixelRatio;
		dc.scale(canvas.pixelRatio, canvas.pixelRatio);
	}
	window.onorientationchange = function() {
		window.onresize();
		refresh();
	}

	window.onresize();
	refresh();
}

function refresh() {
	dc.clearRect(0,0, dc.canvas.width, dc.canvas.height);
	var info = { innerWidth:window.innerWidth, innerHeight:window.innerHeight };
	info.pixelRatio = window.devicePixelRatio ? window.devicePixelRatio : 1;
	document.getElementById("output").innerHTML = JSON.stringify(info).replace(/,/g,', ');
}

document.addEventListener("DOMContentLoaded", function() { init(); }, false);
		</script>
	</head>

	<body>
		<div id="output" style="width:100%; height:160px; overflow:auto;"></div>
		<canvas id="canvas" width="320" height="240" style="width:100%; background:#222;"></canvas>
		<div class="button" onclick="refresh();" ontouchstart="this.ontouchstart=this.onclick; this.onclick=null; this.ontouchstart();">clear</div>
	</body>
</html>
